<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KFON Customer Interest</title>
<style>
  body { font-family: Arial, sans-serif; padding: 12px; max-width: 720px; margin: auto; }
  h1{font-size:1.2rem}
  label{display:block;margin-top:10px;font-weight:600}
  input, select, textarea { width:100%; padding:10px; margin-top:6px; box-sizing:border-box; }
  button{margin-top:14px;padding:12px 16px;font-weight:700}
  .row { display:flex; gap:8px; }
  .col2 { flex:1; }
  .small { width:140px; }
  .success{background:#e6ffed;border-left:4px solid #2aa44f;padding:10px;margin-top:12px}
  .error{background:#ffe6e6;border-left:4px solid #d33;padding:10px;margin-top:12px}
</style>
</head>
<body>
  <h1>KFON — Customer Interest Form</h1>

  <!-- Hidden iframe fallback target -->
  <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>

  <form id="interestForm" method="post" action="https://script.google.com/macros/s/AKfycbxhOKkaGaLJfjVU72gX1Px7VWoC0D1Ub5AI1IMWXkZTQzkTa92DaR0UkbQ4JE3NqRfj/exec" target="hidden_iframe">
    <label>Customer Name<input type="text" name="customerName" required></label>
    <label>Address<textarea name="address" rows="2" required></textarea></label>

    <div class="row">
      <div class="col2"><label>Pincode<input name="pincode" required></label></div>
      <div class="col2"><label>State<input name="state" required></label></div>
    </div>

    <div class="row">
      <div class="col2"><label>District<input name="district" required></label></div>
      <div class="col2"><label>Email ID<input type="email" name="email"></label></div>
    </div>

    <label>Phone Number<input name="phone" required pattern="[0-9]{7,15}" title="numbers only"></label>

    <label>Already using another ISP?
      <select name="alreadyUsingIsp" id="alreadyUsingIsp">
        <option value="No">No</option>
        <option value="Yes">Yes</option>
      </select>
    </label>

    <label>If yes which ISP<input name="whichIsp" placeholder="e.g. Airtel / Jio / Local ISP"></label>

    <label>LNP Name (Local Cable Operator)<input name="lnpName"></label>
    <label>Plan Needed<input name="planNeeded" placeholder="e.g. 100 Mbps / 200 GB"></label>

    <div class="row">
      <div class="col2"><label>Connection Needed Date<input type="date" name="connectionDate"></label></div>
      <div class="col2"><label>Feasible or Not
        <select name="feasible">
          <option>Feasible</option>
          <option>Not Feasible</option>
          <option>Pending Field Visit</option>
        </select>
      </label></div>
    </div>

    <label>Notes (optional)<textarea name="notes" rows="2"></textarea></label>

    <button type="submit">Submit</button>
  </form>

  <div id="msg"></div>

<script>
  const POST_URL = 'https://script.google.com/macros/s/AKfycbxhOKkaGaLJfjVU72gX1Px7VWoC0D1Ub5AI1IMWXkZTQzkTa92DaR0UkbQ4JE3NqRfj/exec';
  const form = document.getElementById('interestForm');
  const msg = document.getElementById('msg');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    msg.innerHTML = '<div class="">Submitting…</div>';

    const data = Object.fromEntries(new FormData(form).entries());
    data.phone = data.phone ? data.phone.replace(/\s+/g,'') : '';

    // Try JSON fetch first
    try {
      const res = await fetch(POST_URL, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(data),
      });

      // if response isn't JSON or network blocked, this may throw in parsing
      const j = await res.json();
      if (j && j.status === 'success') {
        msg.innerHTML = '<div class="success">Saved ✓ — Next record ready.</div>';
        form.reset();
        return;
      } else {
        // fallback to form POST if server returned non-success
        fallbackSubmit();
      }
    } catch (err) {
      // likely CORS or network error — fallback to regular form submit (hidden iframe)
      fallbackSubmit();
    }
  });

  function fallbackSubmit(){
    // Submit the form normally to the Apps Script using the hidden iframe target.
    // The Apps Script will receive the fields as e.parameter.
    try {
      form.submit();
      // We cannot reliably read iframe response because of cross-origin, so just assume success.
      msg.innerHTML = '<div class="success">Submitted (via form). If you do not see the row in Google Sheets in a few seconds, inform admin.</div>';
      form.reset();
    } catch (e) {
      msg.innerHTML = '<div class="error">Unable to submit: ' + e.toString() + '</div>';
    }
  }
</script>
</body>
</html>

